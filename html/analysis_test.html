<!DOCTYPE html>
<!--
     Sends test data to a Reactome 3.x analysis, and then opens a new web page to
     show the results of the analysis.  Assumes that the analysis service is
     running on the same machine as the one you use for serving this web page.
     If you want to run the analysis on a different machine, you will need
     to set up a proxy.  E.g. with Apache's mod_proxy:

     ProxyPass      /ReactomeGWT/  http://www.reactome.org/ReactomeGWT/

     Make sure the proxy also transports all of the request header information
     unchanged, e.g. by setting ProxyPreserveHost to On.
-->
<html>
    <head>
        <script>
            reactomeQuery = "TS_HUMAN\nSUIS_HUMAN\nSUM1_HUMAN\nO00139\nO00186\nO00187\nO00204\nO00217\nO00231\nO00232\nO00233\nO00254\nO00267\nO00268\nO00273\nO00303\nO00311\nO00330\nO00338\nO00411\nO00459\nO00482\nO00487\nO00547\nO00716\nO00757\nO00763\nO007634\nO02923\nO14521\nO14548\nO14556\nO14672\nO1467252\nO1467253\nO1467254\nO14694\nO14757\nO14763\nO14818\nO14880\nO14920\nO14957\nO14964\nO14965\nO14977\nO15067\nO15078\nO15111\nO15120\nO15123\nO15129\nO15160\nO15169\nO15229\nO15230\nO15239\nO15371\nO15372\nO15379\nO15382\nO15421\nO15427\nO15438\nO15455\nO15488\nO15504\nO15514\nO15527\nO155Q13685\nO15P05091\nO19682\nO19798\nO43148\nO43172\nO43181\nO43184\nO43198\nO43264\nO43303\nO43324\nO43353\nO43390\nO43451\nO43513\nO43521\nO43524\nO43674\nO43676\nO43677\nO43678\nO43684\nO43688\nO43708\nO43741\nO43747\nO43772\nO43805\nO43809\nO43837\nO43903\nO43920\nO43929\nO60216\nO60240\nO60244\nO60262\nO60266\nO60346\nO60496\nO60503\nO60508\nO60563\nO605635\nO60566\nO60583\nO60602\nO60603\nO60669\nO60671\nO60841\nO60906\nO60907\nO60921\nO60934\nO60942\nO75100\nO75122\nO75251\nO75306\nO75322\nO75376\nO75380\nO75390\nO75438\nO75448\nO75489\nO75531\nO75533\nO75578\nO75582\nO75665\nO75703\nO75746\nO75791\nO75821\nO75822\nO75845\nO75881\nO75935\nO75937\nO75947\nO75964\nO75971\nO759P45954\nO76075\nO7P1530933\nO94906\nO94913\nO94925\nO94973\nO94975\nO94986\nO95067\nO95101\nO95169\nO95182\nO95190\nO95229\nO95243\nO95400\nO95485\nO95684\nO95749\nO95971\nO95992\nO95999\nO96015\nO96017\nO96020\nP00338\nP00374\nP00390\nP00439\nP00451\nP00480\nP00488\nP00491\nP00505\nP00533\nP00558\nP00568\nP00734\nP00740\nP00742\nP00746\nP00749\nP00751\nP00813\nP0081318\nP00966\nP01031\nP01042\nP01133\nP01137\nP01138\nP01215\nP01233\nP01275\nP01343\nP01732\nP01842\nP02452\nP02458\nP02545\nP02655\nP02656\nP02675\nP02679\nP02746\nP02774\nP03951\nP03952\nP04004\nP04049\nP04085\nP04114\nP041143\nP041144\nP041145\nP04118\nP04150\nP04183\nP04275\nP04406\nP04435\nP04629\nP04798\nP05062\nP0506234\nP05089\nP05091\nP05093\nP05106\nP05108\nP05120\nP05141\nP05155\nP05160\nP05181\nP05198\nP05362\nP05386\nP05387";

            /**
             * Starts an analysis, using the supplied query, which should be in the form
             * of a newline-separated list of protein/gene/compound IDs or a tab separated
             * list of IDs and numeric expression/proteomics/metabolomics values.
             *
             * @param {string} query user-supplied data
             */
            reactomeAnalysis = function(query) {
                var xmlhttp = null;
                if (window.XMLHttpRequest) {
                    xmlhttp = new XMLHttpRequest();
                } else if (window.ActiveXObject) {
                    xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
                } else {
                    alert('Perhaps your browser does not support xmlhttprequests?');
                    return;
                }
                
                var url = "/Analysis/service/analysis/multipart/quick/combined_analysis_set";
                try {
                    xmlhttp.open('POST', url, true);
                    xmlhttp.setRequestHeader("Content-Encoding", "UTF-8");
                    xmlhttp.setRequestHeader("Content-Transfer-Encoding", "binary");
                    xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
                    xmlhttp.setRequestHeader("Accept","text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8");
                    xmlhttp.setRequestHeader("Accept-Language","en-US,en;q=0.5");
                    xmlhttp.setRequestHeader("Accept-Encoding","gzip, deflate");
                    xmlhttp.setRequestHeader("Connection","keep-alive");
                    xmlhttp.send("DATA=" + query);
                    xmlhttp.onreadystatechange = handleRequestStateChange;
                } catch(e) {
                    alert("Can't connect to server:\n" + e.toString());
                }

                /**
                 * Opens a new tab/page to display the analysis results.  This function
                 * actually gets called every time the request state changes, but it
                 * only does something once the request is finished.  At this point,
                 * the request will pass back an ID for the analysis, which will be
                 * used to build the URL for the results tab/page.
                 */
                function handleRequestStateChange() {
                    var readyState = xmlhttp.readyState;
                    var status = xmlhttp.status;
                    if (readyState == 4) {
                        if (status == 200) {
                            var response = xmlhttp.responseText;
                            if (response.indexOf("springModel") >= 0) {
                                var sResponse = JSON.parse(response); // safer than eval
                                response = sResponse.springModel;
                            }
                            window.open('/Analysis/index.html#TOOLS=1&TOOL_TYPE=combined_analysis_set&TAB=1&ANALYSIS_ID=' + response, '_blank');
                        } else {
                            alert("Bad status: " + status);
                        }
                    }
                };
            }
        </script>
    </head>
    
    <body>
        <h1>Reactome 3.0 analysis</h1>
        
        <p>When you click on "Start analysis", the analysis will be started and you will then be transferred to the results page.</p>
        <p> <button type="button" onclick="reactomeAnalysis(reactomeQuery)">Start analysis</button> </p>
    </body>
</html>

